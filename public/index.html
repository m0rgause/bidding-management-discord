<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Discord Project Hub - Real-time Chat</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }
      .header {
        background: #5865f2;
        color: white;
        padding: 20px;
        text-align: center;
      }
      .chat-container {
        height: 400px;
        overflow-y: auto;
        padding: 20px;
        border-bottom: 1px solid #e0e0e0;
      }
      .message {
        margin-bottom: 15px;
        padding: 10px;
        border-radius: 8px;
      }
      .message.discord {
        background-color: #e8f4ff;
        border-left: 4px solid #5865f2;
      }
      .message.web {
        background-color: #f0f8ff;
        border-left: 4px solid #00d4aa;
      }
      .message.system {
        background-color: #fff3cd;
        border-left: 4px solid #ffc107;
        font-style: italic;
      }
      .message-header {
        font-weight: bold;
        color: #333;
        margin-bottom: 5px;
      }
      .message-content {
        color: #555;
      }
      .timestamp {
        font-size: 0.8em;
        color: #888;
        float: right;
      }
      .input-container {
        padding: 20px;
        display: flex;
        gap: 10px;
      }
      input[type="text"] {
        flex: 1;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
      }
      button {
        padding: 12px 20px;
        background: #5865f2;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
      }
      button:hover {
        background: #4752c4;
      }
      button:disabled {
        background: #ccc;
        cursor: not-allowed;
      }
      .status {
        padding: 10px 20px;
        background: #f8f9fa;
        border-bottom: 1px solid #e0e0e0;
        font-size: 14px;
      }
      .status.connected {
        color: #28a745;
      }
      .status.disconnected {
        color: #dc3545;
      }
      .username-input {
        margin-bottom: 10px;
      }
      .stats {
        display: flex;
        justify-content: space-around;
        padding: 15px;
        background: #f8f9fa;
        border-top: 1px solid #e0e0e0;
      }
      .stat {
        text-align: center;
      }
      .stat-number {
        font-size: 24px;
        font-weight: bold;
        color: #5865f2;
      }
      .stat-label {
        font-size: 12px;
        color: #666;
        text-transform: uppercase;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üéÆ Discord Project Hub</h1>
        <p>Real-time communication between Web and Discord</p>
      </div>

      <div class="status" id="status">
        <span id="connection-status">Disconnected</span>
      </div>

      <div class="chat-container" id="messages">
        <div class="message system">
          <div class="message-content">
            Welcome! Messages will appear here...
          </div>
        </div>
      </div>

      <div class="input-container">
        <input
          type="text"
          id="username"
          placeholder="Your username"
          value="WebUser"
          class="username-input"
        />
        <input
          type="text"
          id="messageInput"
          placeholder="Type your message..."
        />
        <button onclick="sendMessage()" id="sendBtn" disabled>
          Send to Discord
        </button>
      </div>

      <div class="stats">
        <div class="stat">
          <div class="stat-number" id="messageCount">0</div>
          <div class="stat-label">Messages</div>
        </div>
        <div class="stat">
          <div class="stat-number" id="discordMessages">0</div>
          <div class="stat-label">From Discord</div>
        </div>
        <div class="stat">
          <div class="stat-number" id="webMessages">0</div>
          <div class="stat-label">From Web</div>
        </div>
      </div>
    </div>

    <script>
      // Initialize Socket.IO connection
      const socket = io("http://localhost:3000");

      // Statistics
      let totalMessages = 0;
      let discordMessagesCount = 0;
      let webMessagesCount = 0;

      // Connection status
      socket.on("connect", () => {
        console.log("Connected to server");
        updateConnectionStatus(true);
        document.getElementById("sendBtn").disabled = false;
        addSystemMessage("Connected to server");
      });

      socket.on("disconnect", () => {
        console.log("Disconnected from server");
        updateConnectionStatus(false);
        document.getElementById("sendBtn").disabled = true;
        addSystemMessage("Disconnected from server");
      });

      // Handle messages from Discord
      socket.on("discordmsg", (data) => {
        console.log("Message from Discord:", data);
        addDiscordMessage(data);
        discordMessagesCount++;
        updateStats();
      });

      // Handle project notifications
      socket.on("new_project", (data) => {
        addSystemMessage(`üÜï New project created: ${data.title}`);
      });

      socket.on("project_update", (data) => {
        addSystemMessage(`üìù Project updated: ${data.title}`);
      });

      socket.on("new_bid", (data) => {
        addSystemMessage(`üí∞ New bid placed on: ${data.projectTitle}`);
      });

      // Handle errors
      socket.on("error", (error) => {
        addSystemMessage(`‚ùå Error: ${error.message}`);
      });

      // Send message to Discord
      function sendMessage() {
        const messageInput = document.getElementById("messageInput");
        const usernameInput = document.getElementById("username");
        const message = messageInput.value.trim();
        const username = usernameInput.value.trim() || "WebUser";

        if (message) {
          socket.emit("webmsg", {
            message: message,
            username: username,
          });

          addWebMessage({
            user: username,
            content: message,
            timestamp: Date.now(),
          });

          messageInput.value = "";
          webMessagesCount++;
          updateStats();
        }
      }

      // Add message to chat
      function addDiscordMessage(data) {
        const messagesDiv = document.getElementById("messages");
        const messageDiv = document.createElement("div");
        messageDiv.className = "message discord";

        messageDiv.innerHTML = `
                <div class="message-header">
                    üéÆ ${data.user}
                    <span class="timestamp">${formatTime(data.timestamp)}</span>
                </div>
                <div class="message-content">${escapeHtml(data.content)}</div>
            `;

        messagesDiv.appendChild(messageDiv);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
        totalMessages++;
      }

      function addWebMessage(data) {
        const messagesDiv = document.getElementById("messages");
        const messageDiv = document.createElement("div");
        messageDiv.className = "message web";

        messageDiv.innerHTML = `
                <div class="message-header">
                    üåê ${data.user}
                    <span class="timestamp">${formatTime(data.timestamp)}</span>
                </div>
                <div class="message-content">${escapeHtml(data.content)}</div>
            `;

        messagesDiv.appendChild(messageDiv);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
        totalMessages++;
      }

      function addSystemMessage(message) {
        const messagesDiv = document.getElementById("messages");
        const messageDiv = document.createElement("div");
        messageDiv.className = "message system";

        messageDiv.innerHTML = `
                <div class="message-content">
                    ${message}
                    <span class="timestamp">${formatTime(Date.now())}</span>
                </div>
            `;

        messagesDiv.appendChild(messageDiv);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
      }

      // Update connection status
      function updateConnectionStatus(connected) {
        const statusElement = document.getElementById("connection-status");
        const statusContainer = document.getElementById("status");

        if (connected) {
          statusElement.textContent = "üü¢ Connected to server";
          statusContainer.className = "status connected";
        } else {
          statusElement.textContent = "üî¥ Disconnected from server";
          statusContainer.className = "status disconnected";
        }
      }

      // Update statistics
      function updateStats() {
        document.getElementById("messageCount").textContent = totalMessages;
        document.getElementById("discordMessages").textContent =
          discordMessagesCount;
        document.getElementById("webMessages").textContent = webMessagesCount;
      }

      // Utility functions
      function formatTime(timestamp) {
        return new Date(timestamp).toLocaleTimeString();
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      // Enter key to send message
      document
        .getElementById("messageInput")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            sendMessage();
          }
        });

      // Initialize
      updateConnectionStatus(false);
      updateStats();
    </script>
  </body>
</html>
